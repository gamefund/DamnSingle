/**
 * 我的猫
 */
var myKittyInit = function (kitty_id, kitty_type) {
    $("body").empty();

    var obj = {"page":"myKittyInit","kitty_id":kitty_id,"kitty_type":kitty_type};
    leftToRightArray.push(obj);
    headerInit();

    $("body").append(myKittyText);
    fastCheck();
    waitModel();
    clickHeaderImage(1);
}

/**
 * 点击事件
 */
var fastCheck = function() {
    $(".filter-kitties-down").click(function(){
        console.log("111")
        $(".self-filter-displayArea").toggle();
    });
    $('.kitties-column-down').bind("change",function(){
        waitModel();
        clickHeaderImage(1);
     });
    $(".self-filter-type-content .self-filter-type").click(function(){
        if($(this).hasClass("filter-item-addclass")){
            return;
        }
        $(this).addClass('filter-item-addclass').siblings().removeClass('filter-item-addclass'); 
        waitModel(); 
        clickHeaderImage(1);
    });
    
    $('#chose-page-button .active').click(function() {
        var index = $('#chose-page-button .active').html();
        waitModel();
        clickHeaderImage(index);
    });
    // $('.next-page').click(function() {
    //     var index = $('#chose-page-button .active').html();
    //     clickHeaderImage(parseInt(index) + 1);
    // });
    
}

/**
 * 信息填充
 */
var pageMessage = function(data) {
    if(data.total == 0) {
        $('.chose-page').hide();
        return;
    }
    $('.chose-page').show();
    $('.have-kitties-num').html(data.total + "&nbsp" + "kitties");
    $('.owner-name').html(data.kitties[0].auction.seller.nickname);
    // $('.owner-headImage').css("backgroundImage", "url("+ data.kitties[0].auction.seller.image +")");
    $('.owner-headImage').css("backgroundImage", "url(./module/profile/1.png)");
    // kittyMessage(data);
    $('.owner-address').html(data.kitties[0].auction.seller.seller_address);
}

    var myPagePart = function(data) {
        var totalDataNum = data.total;
        if(totalDataNum == 0) {
            $('#page').hide();
            return;
        }
        $('#chose-page-button').pagination({
            totalData: totalDataNum,
            showData: data.limitNum,
            // jump:true,
            coping:true,
            // homePage:'首页',
            // endPage:'末页',
            // prevContent:'Preview',
            // nextContent:'Next'
            // count: 3
            callback: function(api) {
                var index = api.getCurrent();
                waitModel();
                clickHeaderImage(index, 1);
                $('body,kitty-owner-main').animate({scrollTop: 0}, 100);
            }
        });
    }


/**
 * kitty信息
 */
var kittyMessage = function(data) {
    if(!isNaN(data)) {
        return;
    };
    var itemText = "";
    var itemprice = 0;
    var kittyName = "";
    for(var i=0; i < data.kitties.length; i++) {
        if(data.kitties[i].status.is_ready) {
            if(data.kitties[i].auction.type == "sire") {
                itemText = LText.ForSire;
                itemprice = (data.kitties[i].auction.current_price * ethRate).toFixed(3);
            } else if(data.kitties[i].auction.type == "sale") {
                itemText = LText.ForSale; 
                itemprice = (data.kitties[i].auction.current_price * ethRate).toFixed(3);
            } 
        } else {
            itemText = "Resting";
            itemprice = data.kitties[i].status.cooldown;
        }
        if(isNaN(data.kitties[i].name)) {
            kittyName = data.kitties[i].name;
        } else {
            kittyName = LText.Kitty;
        }
        var text =  
            '<div class="kitty-list-item">'+
                '<div class="list-item-container" id="myKittiess'+ data.kitties[i].id +'" onclick="jumpKittyPage(event)">'+
                    '<image class="kitty-item-photos" src="'+ data.kitties[i].image_url +'" style="position: absolute;width: 93%;height: 80vw;">' +
                    '<div class="list-item-status" id="myKittiess-status'+ data.kitties[i].id +'">'+
                        '<div class="list-status-item">'+
                            '<i class="list-status-itemIcon"></i>'+
                            '<span class="list-status-itemText">'+ itemText +'</span>'+
                            '<small style="color: #9c9c9b">≡</small>'+
                            '<span class="list-status-itemprice" style="color: #9c9c9b">'+ itemprice +'</span>'+
                        '</div>'+
                    '</div>'+
                '</div>'+
                '<div class="list-item-name">'+ kittyName +' #'+ data.kitties[i].id +'</div>'+
                '<div class="list-item-details">'+
                    '<span class="list-item-details-item">'+ kittyName + '&nbsp' +data.kitties[i].id  +'<span>·</span></span>'+
                    '<span class="list-item-details-item">' + LText.Generation + '&nbsp' + data.kitties[i].generation +'<span>·</span></span>'+
                    '<span class="list-item-details-item-cooldown">Snappy</span>'+
                '</div>'+
                '<div class="list-item-actions">'+
                    '<div class="list-item-actions-action">'+
                        '<span class="list-item-actions-icon"></span>'+
                        '<span class="list-item-actions-number">1</span>'+
                    '</div>'+
                '</div>'+
            '</div>';
        $('.list-item-details-item-cooldown').html(cooldown[data.kitties[i].status.cooldown_index] +  '&nbsp' + "cooldown");
        $('.list-item-actions-number').html(data.kitties[i].purrs.count);
        $('.all-kitties-message').append(text);
        $('#myKittiess'+ data.kitties[i].id +'').css("background-color", data.kitties[i].color);
        if(data.kitties[i].status.is_ready && data.kitties[i].auction.type == "") {
            $('#myKittiess-status'+ data.kitties[i].id +'').hide();
        }
        $('#myKittiess'+ data.kitties[i].id +'').attr("kittyId", data.kitties[i].id).attr("kittyType", data.kitties[i].auction.type);
    }
    pageMessage(data);
}

var jumpKittyPage = function (e) {
    var chooseDataId = $(e.target).parent().attr("kittyId");
    var chooseDataType = $(e.target).parent().attr("kittyType");
    if (chooseDataId == "sale") { //请求购买猫信息
        kittyInit(chooseDataId, chooseDataType);
    } else if (chooseDataId == "sire") { //请求可交配猫信息
        kittyInit(chooseDataId, chooseDataType);
    } else { //猫详情页面
        kittyInit(chooseDataId, chooseDataType);
    }
}

/**
 * 筛选排序点击事件
 */
var clickHeaderImage = function(index, type) {
    var y = $('.list-filter-select option:selected').attr("id");
    var w = $('.self-filter-type .filter-item-addclass').attr("id");
    var index = index;
    if(isNaN(w)) {
        w = 0;
    }
    $.ajax({
        url: Config.address + "homePageSelectKittyByType",
        data: { 
            pageType: 4,
            choseType: y,
            fileType: w,
            index: index,
            userId: userId
        },
        type: "POST",
        success: function(data) {
            console.log(data);
            $(".all-kitties-message").empty();
            kittyMessage(data);
            if(type != 1) {
                myPagePart(data);
            }
            $('.have-kitties-num').html(data.total);
            destory();
        },
        error: function(xhr) {
            var nextJson = {
                title: LText.Title,
                msg: LText.SystemTitle,
                bottonNum: 1,
                bottonMsg: [LText.Ok],    
                func: [OK],
            };
            promptText(nextJson);
            destory();
        }
    });
}